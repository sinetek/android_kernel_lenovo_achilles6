//
// Philippe Michaud-Boudreault [sinetek] <pitwuu@gmail.com>
//   2023
//
//   Reversed engineered MIPI driver for NT36523W panel.
//

#include "lcm_drv.h"

static struct LCM_UTIL_FUNCS lcm_util;
extern void SGM37604A_set_backlight_reg_init(void);


#define SET_RESET_PIN(v)	(lcm_util.set_reset_pin((v)))
#define MDELAY(n)		(lcm_util.mdelay(n))
#define UDELAY(n)		(lcm_util.udelay(n))
#define dsi_set_cmdq_V22(cmdq, cmd, count, ppara, force_update) \
        lcm_util.dsi_set_cmdq_V22(cmdq, cmd, count, ppara, force_update)
#define read_reg_v2(cmd, buffer, buffer_size) \
        lcm_util.dsi_dcs_read_lcm_reg_v2(cmd, buffer, buffer_size)
#define dsi_set_cmdq(pdata, queue_size, force_update) \
        lcm_util.dsi_set_cmdq(pdata, queue_size, force_update)



struct LCM_setting_table {
        unsigned int cmd;
        unsigned char count;
        unsigned char para_list[64];
};

static struct LCM_setting_table lcm_suspend_setting[] = {
        { 0x28,0,{}},
        { 0x10,0,{}},
        { 0xfffc,50, {}},
        { 0x55,0x01,{0xFF}},
        { 0xfffd, 0x00, {} }
};

static struct LCM_setting_table bl_level[] = {
        { 0x51, 0x02, {0x0F, 0xFF} },
        { 0xfffd, 0x00, {} },
};

static struct LCM_setting_table init_setting_vdo[] = {
        { 0x0000fffc, 0x64, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, } },
        { 0x000000ff, 0x01, {0x26, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000a7, 0x01, {0xb3, } },
        { 0x000000ff, 0x01, {0x20, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x00000001, 0x01, {0x25, } },
        { 0x00000005, 0x01, {0xd1, } },
        { 0x00000007, 0x01, {0x87, } },
        { 0x00000008, 0x01, {0x4b, } },
        { 0x0000000e, 0x01, {0x91, } },
        { 0x0000000f, 0x01, {0x69, } },
        { 0x00000095, 0x01, {0xf5, } },
        { 0x00000096, 0x01, {0xf5, } },
        { 0x0000009d, 0x01, {0x00, } },
        { 0x0000009e, 0x01, {0x00, } },
        { 0x0000006d, 0x01, {0x33, } },
        { 0x00000069, 0x01, {0x98, } },
        { 0x00000075, 0x01, {0xa2, } },
        { 0x00000077, 0x01, {0xb3, } },
        { 0x0000000d, 0x01, {0x63, } },
        { 0x000000ff, 0x01, {0x24, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x00000091, 0x01, {0x44, } },
        { 0x00000092, 0x01, {0x7b, } },
        { 0x00000093, 0x01, {0x1a, } },
        { 0x00000094, 0x01, {0x5b, } },
        { 0x00000060, 0x01, {0x96, } },
        { 0x00000061, 0x01, {0x80, } },
        { 0x00000063, 0x01, {0x70, } },
        { 0x000000c2, 0x01, {0x06, } },
        { 0x00000000, 0x01, {0x03, } },
        { 0x00000001, 0x01, {0x03, } },
        { 0x00000002, 0x01, {0x03, } },
        { 0x00000003, 0x01, {0x03, } },
        { 0x00000004, 0x01, {0x03, } },
        { 0x00000005, 0x01, {0x03, } },
        { 0x00000006, 0x01, {0x03, } },
        { 0x00000007, 0x01, {0x03, } },
        { 0x00000008, 0x01, {0x22, } },
        { 0x00000009, 0x01, {0x06, } },
        { 0x0000000a, 0x01, {0x05, } },
        { 0x0000000b, 0x01, {0x1d, } },
        { 0x0000000c, 0x01, {0x1c, } },
        { 0x0000000d, 0x01, {0x11, } },
        { 0x0000000e, 0x01, {0x10, } },
        { 0x0000000f, 0x01, {0x0f, } },
        { 0x00000010, 0x01, {0x0e, } },
        { 0x00000011, 0x01, {0x0d, } },
        { 0x00000012, 0x01, {0x0c, } },
        { 0x00000013, 0x01, {0x04, } },
        { 0x00000014, 0x01, {0x03, } },
        { 0x00000015, 0x01, {0x03, } },
        { 0x00000016, 0x01, {0x03, } },
        { 0x00000017, 0x01, {0x03, } },
        { 0x00000018, 0x01, {0x03, } },
        { 0x00000019, 0x01, {0x03, } },
        { 0x0000001a, 0x01, {0x03, } },
        { 0x0000001b, 0x01, {0x03, } },
        { 0x0000001c, 0x01, {0x03, } },
        { 0x0000001d, 0x01, {0x03, } },
        { 0x0000001e, 0x01, {0x22, } },
        { 0x0000001f, 0x01, {0x06, } },
        { 0x00000020, 0x01, {0x05, } },
        { 0x00000021, 0x01, {0x1d, } },
        { 0x00000022, 0x01, {0x1c, } },
        { 0x00000023, 0x01, {0x11, } },
        { 0x00000024, 0x01, {0x10, } },
        { 0x00000025, 0x01, {0x0f, } },
        { 0x00000026, 0x01, {0x0e, } },
        { 0x00000027, 0x01, {0x0d, } },
        { 0x00000028, 0x01, {0x0c, } },
        { 0x00000029, 0x01, {0x04, } },
        { 0x0000002a, 0x01, {0x03, } },
        { 0x0000002b, 0x01, {0x03, } },
        { 0x0000002f, 0x01, {0x04, } },
        { 0x00000030, 0x01, {0x32, } },
        { 0x00000031, 0x01, {0x41, } },
        { 0x00000033, 0x01, {0x32, } },
        { 0x00000034, 0x01, {0x04, } },
        { 0x00000035, 0x01, {0x41, } },
        { 0x00000037, 0x01, {0x44, } },
        { 0x00000038, 0x01, {0x40, } },
        { 0x00000039, 0x01, {0x00, } },
        { 0x0000003a, 0x01, {0x01, } },
        { 0x0000003b, 0x01, {0x43, } },
        { 0x0000003d, 0x01, {0x93, } },
        { 0x000000ab, 0x01, {0x44, } },
        { 0x000000ac, 0x01, {0x40, } },
        { 0x0000004d, 0x01, {0x21, } },
        { 0x0000004e, 0x01, {0x43, } },
        { 0x0000004f, 0x01, {0x65, } },
        { 0x00000051, 0x01, {0x56, } },
        { 0x00000052, 0x01, {0x34, } },
        { 0x00000053, 0x01, {0x12, } },
        { 0x00000055, 0x02, {0x83, 0x03, } },
        { 0x00000056, 0x01, {0x06, } },
        { 0x00000058, 0x01, {0x21, } },
        { 0x00000059, 0x01, {0x40, } },
        { 0x0000005a, 0x01, {0x02, } },
        { 0x0000005b, 0x01, {0x53, } },
        { 0x0000005e, 0x02, {0x00, 0x0c, } },
        { 0x0000005f, 0x01, {0x00, } },
        { 0x0000007a, 0x01, {0x00, } },
        { 0x0000007b, 0x01, {0x00, } },
        { 0x0000007c, 0x01, {0x00, } },
        { 0x0000007d, 0x01, {0x00, } },
        { 0x0000007e, 0x01, {0x20, } },
        { 0x0000007f, 0x01, {0x3c, } },
        { 0x00000080, 0x01, {0x00, } },
        { 0x00000081, 0x01, {0x00, } },
        { 0x00000082, 0x01, {0x08, } },
        { 0x00000097, 0x01, {0x02, } },
        { 0x000000c5, 0x01, {0x10, } },
        { 0x000000d7, 0x01, {0x55, } },
        { 0x000000d8, 0x01, {0x55, } },
        { 0x000000d9, 0x01, {0x23, } },
        { 0x000000da, 0x01, {0x05, } },
        { 0x000000db, 0x01, {0x01, } },
        { 0x000000dc, 0x01, {0x7b, } },
        { 0x000000dd, 0x01, {0x55, } },
        { 0x000000de, 0x01, {0x27, } },
        { 0x000000df, 0x01, {0x01, } },
        { 0x000000e0, 0x01, {0x7b, } },
        { 0x000000e1, 0x01, {0x01, } },
        { 0x000000e2, 0x01, {0x7b, } },
        { 0x000000e3, 0x01, {0x01, } },
        { 0x000000e4, 0x01, {0x7b, } },
        { 0x000000e5, 0x01, {0x01, } },
        { 0x000000e6, 0x01, {0x7b, } },
        { 0x000000e7, 0x01, {0x00, } },
        { 0x000000e8, 0x01, {0x00, } },
        { 0x000000e9, 0x01, {0x01, } },
        { 0x000000ea, 0x01, {0x7b, } },
        { 0x000000eb, 0x01, {0x01, } },
        { 0x000000ee, 0x01, {0x7b, } },
        { 0x000000ef, 0x01, {0x01, } },
        { 0x000000f0, 0x01, {0x7b, } },
        { 0x000000b6, 0x0c, {0x05, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x05, 0x00, 0x00, } },
        { 0x000000ff, 0x01, {0x25, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x0000001e, 0x01, {0x00, } },
        { 0x0000001f, 0x01, {0x02, } },
        { 0x00000020, 0x01, {0x53, } },
        { 0x00000025, 0x01, {0x00, } },
        { 0x00000026, 0x01, {0x02, } },
        { 0x00000027, 0x01, {0x53, } },
        { 0x0000003f, 0x01, {0x80, } },
        { 0x00000040, 0x01, {0x04, } },
        { 0x00000043, 0x01, {0x00, } },
        { 0x00000044, 0x01, {0x02, } },
        { 0x00000045, 0x01, {0x53, } },
        { 0x00000048, 0x01, {0x02, } },
        { 0x00000049, 0x01, {0x43, } },
        { 0x0000005b, 0x01, {0x80, } },
        { 0x0000005c, 0x01, {0x00, } },
        { 0x0000005d, 0x01, {0x02, } },
        { 0x0000005e, 0x01, {0x53, } },
        { 0x00000061, 0x01, {0x02, } },
        { 0x00000062, 0x01, {0x53, } },
        { 0x00000068, 0x01, {0x0c, } },
        { 0x000000ff, 0x01, {0x26, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x00000000, 0x01, {0xa1, } },
        { 0x00000002, 0x01, {0x31, } },
        { 0x00000004, 0x01, {0x28, } },
        { 0x0000000a, 0x01, {0xf2, } },
        { 0x00000006, 0x01, {0x20, } },
        { 0x0000000c, 0x01, {0x13, } },
        { 0x0000000d, 0x01, {0x0a, } },
        { 0x0000000f, 0x01, {0x0a, } },
        { 0x00000011, 0x01, {0x00, } },
        { 0x00000012, 0x01, {0x50, } },
        { 0x00000013, 0x01, {0x4d, } },
        { 0x00000014, 0x01, {0x61, } },
        { 0x00000015, 0x01, {0x00, } },
        { 0x00000016, 0x01, {0x10, } },
        { 0x00000017, 0x01, {0xa0, } },
        { 0x00000018, 0x01, {0x86, } },
        { 0x00000019, 0x01, {0x0c, } },
        { 0x0000001a, 0x01, {0x00, } },
        { 0x0000001b, 0x01, {0x0c, } },
        { 0x0000001c, 0x01, {0x00, } },
        { 0x0000002a, 0x01, {0x0c, } },
        { 0x0000002b, 0x01, {0x00, } },
        { 0x00000020, 0x01, {0x00, } },
        { 0x0000001d, 0x01, {0x00, } },
        { 0x0000001e, 0x01, {0x7d, } },
        { 0x0000001f, 0x01, {0x7d, } },
        { 0x0000002f, 0x01, {0x05, } },
        { 0x00000030, 0x01, {0x7d, } },
        { 0x00000031, 0x01, {0x02, } },
        { 0x00000032, 0x01, {0x77, } },
        { 0x00000033, 0x01, {0x11, } },
        { 0x00000034, 0x01, {0x71, } },
        { 0x00000035, 0x01, {0x16, } },
        { 0x00000039, 0x01, {0x0c, } },
        { 0x0000003a, 0x01, {0x7e, } },
        { 0x0000003b, 0x01, {0x06, } },
        { 0x000000c8, 0x01, {0x04, } },
        { 0x000000c9, 0x01, {0x84, } },
        { 0x000000ca, 0x01, {0x4e, } },
        { 0x000000cb, 0x01, {0x00, } },
        { 0x000000a9, 0x01, {0x4c, } },
        { 0x000000aa, 0x01, {0x4a, } },
        { 0x000000ab, 0x01, {0x49, } },
        { 0x000000ac, 0x01, {0x47, } },
        { 0x000000ad, 0x01, {0x45, } },
        { 0x000000ae, 0x01, {0x43, } },
        { 0x000000ff, 0x01, {0x27, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000d1, 0x01, {0x24, } },
        { 0x000000d2, 0x01, {0x30, } },
        { 0x000000c0, 0x01, {0x18, } },
        { 0x000000c1, 0x01, {0x00, } },
        { 0x000000c2, 0x01, {0x00, } },
        { 0x00000056, 0x01, {0x06, } },
        { 0x00000058, 0x01, {0x80, } },
        { 0x00000059, 0x01, {0x50, } },
        { 0x0000005a, 0x01, {0x00, } },
        { 0x0000005b, 0x01, {0x14, } },
        { 0x0000005c, 0x01, {0x00, } },
        { 0x0000005d, 0x01, {0x01, } },
        { 0x0000005e, 0x01, {0x20, } },
        { 0x0000005f, 0x01, {0x10, } },
        { 0x00000060, 0x01, {0x00, } },
        { 0x00000061, 0x01, {0x1b, } },
        { 0x00000062, 0x01, {0x00, } },
        { 0x00000063, 0x01, {0x01, } },
        { 0x00000064, 0x01, {0x22, } },
        { 0x00000065, 0x01, {0x1a, } },
        { 0x00000066, 0x01, {0x00, } },
        { 0x00000067, 0x01, {0x01, } },
        { 0x00000068, 0x01, {0x23, } },
        { 0x00000098, 0x01, {0x01, } },
        { 0x000000b4, 0x01, {0x03, } },
        { 0x0000009b, 0x01, {0xbd, } },
        { 0x000000a0, 0x01, {0x90, } },
        { 0x000000ab, 0x01, {0x14, } },
        { 0x000000bc, 0x01, {0x0c, } },
        { 0x000000bd, 0x01, {0x28, } },
        { 0x000000ff, 0x01, {0x2a, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x00000022, 0x01, {0x2f, } },
        { 0x00000023, 0x01, {0x08, } },
        { 0x00000024, 0x01, {0x00, } },
        { 0x00000025, 0x01, {0x7b, } },
        { 0x00000026, 0x01, {0xf8, } },
        { 0x00000027, 0x01, {0x00, } },
        { 0x00000028, 0x01, {0x1a, } },
        { 0x00000029, 0x01, {0x00, } },
        { 0x0000002a, 0x01, {0x1a, } },
        { 0x0000002b, 0x01, {0x00, } },
        { 0x0000002d, 0x01, {0x1a, } },
        { 0x00000064, 0x01, {0x96, } },
        { 0x00000065, 0x01, {0x00, } },
        { 0x00000066, 0x01, {0x00, } },
        { 0x0000006a, 0x01, {0x96, } },
        { 0x0000006b, 0x01, {0x00, } },
        { 0x0000006c, 0x01, {0x00, } },
        { 0x00000070, 0x01, {0x92, } },
        { 0x00000071, 0x01, {0x00, } },
        { 0x00000072, 0x01, {0x00, } },
        { 0x000000a2, 0x01, {0x33, } },
        { 0x000000a3, 0x01, {0x30, } },
        { 0x000000a4, 0x01, {0xc0, } },
        { 0x000000e8, 0x01, {0x00, } },
        { 0x000000ff, 0x01, {0x20, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000b0, 0x10, {0x00, 0x01, 0x00, 0x11, 0x00, 0x2c, 0x00, 0x43, 0x00, 0x58, 0x00, 0x6b, 0x00, 0x7d, 0x00, 0x8d, } },
        { 0x000000b1, 0x10, {0x00, 0x9b, 0x00, 0xce, 0x00, 0xf7, 0x01, 0x38, 0x01, 0x6c, 0x01, 0xbc, 0x01, 0xfd, 0x01, 0xff, } },
        { 0x000000b2, 0x10, {0x02, 0x3d, 0x02, 0x83, 0x02, 0xaf, 0x02, 0xe6, 0x03, 0x0a, 0x03, 0x1a, 0x03, 0x27, 0x03, 0x35, } },
        { 0x000000b3, 0x0c, {0x03, 0x43, 0x03, 0x53, 0x03, 0x63, 0x03, 0x70, 0x03, 0x77, 0x03, 0x78, } },
        { 0x000000b4, 0x10, {0x00, 0x01, 0x00, 0x11, 0x00, 0x2c, 0x00, 0x43, 0x00, 0x58, 0x00, 0x6b, 0x00, 0x7d, 0x00, 0x8d, } },
        { 0x000000b5, 0x10, {0x00, 0x9b, 0x00, 0xce, 0x00, 0xf7, 0x01, 0x38, 0x01, 0x6c, 0x01, 0xbc, 0x01, 0xfd, 0x01, 0xff, } },
        { 0x000000b6, 0x10, {0x02, 0x3d, 0x02, 0x83, 0x02, 0xaf, 0x02, 0xe6, 0x03, 0x0a, 0x03, 0x1a, 0x03, 0x27, 0x03, 0x35, } },
        { 0x000000b7, 0x0c, {0x03, 0x43, 0x03, 0x53, 0x03, 0x63, 0x03, 0x70, 0x03, 0x77, 0x03, 0x78, } },
        { 0x000000b8, 0x10, {0x00, 0x01, 0x00, 0x11, 0x00, 0x2c, 0x00, 0x43, 0x00, 0x58, 0x00, 0x6b, 0x00, 0x7d, 0x00, 0x8d, } },
        { 0x000000b9, 0x10, {0x00, 0x9b, 0x00, 0xce, 0x00, 0xf7, 0x01, 0x38, 0x01, 0x6c, 0x01, 0xbc, 0x01, 0xfd, 0x01, 0xff, } },
        { 0x000000ba, 0x10, {0x02, 0x3d, 0x02, 0x83, 0x02, 0xaf, 0x02, 0xe6, 0x03, 0x0a, 0x03, 0x1a, 0x03, 0x27, 0x03, 0x35, } },
        { 0x000000bb, 0x0c, {0x03, 0x43, 0x03, 0x53, 0x03, 0x63, 0x03, 0x70, 0x03, 0x77, 0x03, 0x78, } },
        { 0x000000ff, 0x01, {0x21, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000b0, 0x10, {0x00, 0x01, 0x00, 0x11, 0x00, 0x2c, 0x00, 0x43, 0x00, 0x58, 0x00, 0x6b, 0x00, 0x7d, 0x00, 0x8d, } },
        { 0x000000b1, 0x10, {0x00, 0x9b, 0x00, 0xce, 0x00, 0xf7, 0x01, 0x38, 0x01, 0x6c, 0x01, 0xbc, 0x01, 0xfd, 0x01, 0xff, } },
        { 0x000000b2, 0x10, {0x02, 0x3d, 0x02, 0x83, 0x02, 0xaf, 0x02, 0xe6, 0x03, 0x0a, 0x03, 0x54, 0x03, 0x61, 0x03, 0x6f, } },
        { 0x000000b3, 0x0c, {0x03, 0x7d, 0x03, 0x8d, 0x03, 0x9d, 0x03, 0xaa, 0x03, 0xb1, 0x03, 0xb2, } },
        { 0x000000b4, 0x11, {0x00, 0x01, 0x00, 0x11, 0x00, 0x2c, 0x00, 0x43, 0x00, 0x58, 0x00, 0x6b, 0x00, 0x7d, 0x00, 0x8d, 0x00, } },
        { 0x000000b5, 0x11, {0x00, 0x9b, 0x00, 0xce, 0x00, 0xf7, 0x01, 0x38, 0x01, 0x6c, 0x01, 0xbc, 0x01, 0xfd, 0x01, 0xff, 0x00, } },
        { 0x000000b6, 0x11, {0x02, 0x3d, 0x02, 0x83, 0x02, 0xaf, 0x02, 0xe6, 0x03, 0x0a, 0x03, 0x54, 0x03, 0x61, 0x03, 0x6f, 0x00, } },
        { 0x000000b7, 0x0c, {0x03, 0x7d, 0x03, 0x8d, 0x03, 0x9d, 0x03, 0xaa, 0x03, 0xb1, 0x03, 0xb2, } },
        { 0x000000b8, 0x10, {0x00, 0x01, 0x00, 0x11, 0x00, 0x2c, 0x00, 0x43, 0x00, 0x58, 0x00, 0x6b, 0x00, 0x7d, 0x00, 0x8d, } },
        { 0x000000b9, 0x10, {0x00, 0x9b, 0x00, 0xce, 0x00, 0xf7, 0x01, 0x38, 0x01, 0x6c, 0x01, 0xbc, 0x01, 0xfd, 0x01, 0xff, } },
        { 0x000000ba, 0x10, {0x02, 0x3d, 0x02, 0x83, 0x02, 0xaf, 0x02, 0xe6, 0x03, 0x0a, 0x03, 0x54, 0x03, 0x61, 0x03, 0x6f, } },
        { 0x000000bb, 0x0c, {0x03, 0x7d, 0x03, 0x8d, 0x03, 0x9d, 0x03, 0xaa, 0x03, 0xb1, 0x03, 0xb2, } },
        { 0x000000ff, 0x01, {0x23, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x00000000, 0x01, {0x80, } },
        { 0x00000007, 0x01, {0x00, } },
        { 0x000000ff, 0x01, {0xd0, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x00000002, 0x01, {0x77, } },
        { 0x00000009, 0x01, {0xbf, } },
        { 0x000000ff, 0x01, {0x10, } },
        { 0x0000fffc, 0x0a, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, } },
        { 0x000000b9, 0x01, {0x01, } },
        { 0x000000ff, 0x01, {0x20, } },
        { 0x0000fffc, 0x0a, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, } },
        { 0x00000018, 0x01, {0x40, } },
        { 0x000000ff, 0x01, {0x10, } },
        { 0x0000fffc, 0x0a, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, } },
        { 0x000000b9, 0x01, {0x02, } },
        { 0x000000ff, 0x01, {0x2a, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000f1, 0x01, {0x03, } },
        { 0x000000ff, 0x01, {0x27, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000d0, 0x01, {0x13, } },
        { 0x000000d1, 0x01, {0x54, } },
        { 0x000000d2, 0x01, {0x30, } },
        { 0x000000de, 0x01, {0x43, } },
        { 0x000000df, 0x01, {0x02, } },
        { 0x000000ff, 0x01, {0xf0, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x0000003a, 0x01, {0x08, } },
        { 0x000000ff, 0x01, {0x10, } },
        { 0x0000fffc, 0x64, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, } },
        { 0x000000fb, 0x01, {0x01, } },
        { 0x000000bb, 0x01, {0x13, } },
        { 0x00000053, 0x01, {0x24, } },
        { 0x00000068, 0x02, {0x05, 0x01, } },
        { 0x0000003b, 0x05, {0x03, 0x5b, 0x1a, 0x04, 0x04, } },
        { 0x00000035, 0x01, {0x00, } },
        { 0x00000011, 0x00, {} },
        { 0x0000fffc, 0x64, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, } },
        { 0x00000029, 0x00, {} },
};

static void push_table(void *cmdq, struct LCM_setting_table *table,
                unsigned int count,
                unsigned char force_update)
{
        unsigned int i;
        unsigned int cmd;

        for (i = 0; i < count; i++) {
                cmd = table[i].cmd;

                switch (cmd) {

                        case 0xfffc:
                                MDELAY(table[i].count);
                                break;

                        case 0xfffb:
                                UDELAY(table[i].count);
                                break;

                        case 0xfffd:
                                break;

                        default:
                                dsi_set_cmdq_V22(cmdq, cmd, table[i].count,
                                                table[i].para_list, force_update);
                }
        }
}

static void lcm_set_util_funcs(const struct LCM_UTIL_FUNCS *util)
{
        memcpy(&lcm_util, util, sizeof(struct LCM_UTIL_FUNCS));
}

static void lcm_get_params(struct LCM_PARAMS *params)
{
        printk(KERN_INFO "lcm_get_params\n");

        memset(params, 0, sizeof(struct LCM_PARAMS));

        params->width = 1200;
        params->height = 1920;
        params->type = 2;
        params->physical_width = 138;
        params->physical_height = 222;
        params->dsi.mode = 1;
        params->dsi.switch_mode_enable = 0;
        params->dsi.LANE_NUM = 4;
        params->dsi.data_format.color_order = 0;
        params->dsi.data_format.trans_seq = 0;
        params->dsi.data_format.padding = 0;
        params->dsi.data_format.format = 2;
        params->dsi.packet_size = 256;
        params->dsi.PS = 2;
        params->dsi.vertical_sync_active = 2;
        params->dsi.vertical_backporch = 89;
        params->dsi.vertical_frontporch = 26;
        params->dsi.vertical_active_line = 1920;
        params->dsi.horizontal_sync_active = 4;
        params->dsi.horizontal_backporch = 22;
        params->dsi.horizontal_frontporch = 26;
        params->dsi.horizontal_active_pixel = 1200;
        params->dsi.ssc_disable = 1;
        params->dsi.PLL_CLOCK = 550;
	params->dsi.cont_clock = 0;
        params->dsi.clk_lp_per_line_enable = 1;
        params->dsi.customization_esd_check_enable = 0;
        params->dsi.esd_check_enable = 0;
}

static void lcm_init(void)
{
        printk(KERN_INFO "lcm_init\n");

        OCP2131_write_bytes(0,0x14);
        MDELAY(2);
        OCP2131_write_bytes(1,0x14);
        OCP2131_GPIO_ENP_enable();
        MDELAY(5);
        OCP2131_GPIO_ENN_enable();
        MDELAY(5);
        SET_RESET_PIN(1);
        MDELAY(5);
        SET_RESET_PIN(0);
        MDELAY(5);
        SET_RESET_PIN(1);
        MDELAY(5);
        SET_RESET_PIN(0);
        MDELAY(5);
        SET_RESET_PIN(1);
        tpd_gpio_output(0,1);
        MDELAY(1);
        tpd_gpio_output(0,0);
        MDELAY(5);
        tpd_gpio_output(0,1);
        MDELAY(100);
        push_table(NULL, init_setting_vdo, sizeof(init_setting_vdo) / sizeof(struct LCM_setting_table), 1);
        BACKLIGHT_GPIO_enable();
        SGM37604A_set_backlight_reg_init();
}

static void lcm_suspend(void)
{
        printk(KERN_INFO "lcm_suspend\n");

        BACKLIGHT_GPIO_disable();
        MDELAY(5);
        push_table(NULL, lcm_suspend_setting, sizeof(lcm_suspend_setting) / sizeof(struct LCM_setting_table), 1);
        MDELAY(2);
        OCP2131_GPIO_ENN_disable();
        MDELAY(5);
        OCP2131_GPIO_ENP_disable();
}

static void lcm_resume(void)
{
        printk(KERN_INFO "lcm_resume\n");

        lcm_init();
}

static void lcm_init_power(void)
{
        display_bias_enable();
}

static void lcm_suspend_power(void)
{
        display_bias_disable();
}

static void lcm_resume_power(void)
{
        SET_RESET_PIN(0);
        display_bias_enable();
}

static void lcm_update(unsigned int x,
                       unsigned int y,
                       unsigned int width,
                       unsigned int height)
{
	printk(KERN_INFO "lcm_update\n");

        unsigned int x0 = x;
        unsigned int y0 = y;
        unsigned int x1 = x0 + width - 1;
        unsigned int y1 = y0 + height - 1;

        unsigned char x0_MSB = ((x0 >> 8) & 0xFF);
        unsigned char x0_LSB = (x0 & 0xFF);
        unsigned char x1_MSB = ((x1 >> 8) & 0xFF);
        unsigned char x1_LSB = (x1 & 0xFF);
        unsigned char y0_MSB = ((y0 >> 8) & 0xFF);
        unsigned char y0_LSB = (y0 & 0xFF);
        unsigned char y1_MSB = ((y1 >> 8) & 0xFF);
        unsigned char y1_LSB = (y1 & 0xFF);

        unsigned int data_array[16];

        data_array[0] = 0x00053902;
        data_array[1] = (x1_MSB << 24) | (x0_LSB << 16) | (x0_MSB << 8) | 0x2a;
        data_array[2] = (x1_LSB);
        dsi_set_cmdq(data_array, 3, 1);

        data_array[0] = 0x00053902;
        data_array[1] = (y1_MSB << 24) | (y0_LSB << 16) | (y0_MSB << 8) | 0x2b;
        data_array[2] = (y1_LSB);
        dsi_set_cmdq(data_array, 3, 1);

        data_array[0] = 0x002c3909;
        dsi_set_cmdq(data_array, 1, 0);
}

static unsigned int lcm_compare_id()
{
        printk(KERN_INFO "lcm_compare_id\n");

        uint32_t data_array[3];
        uint8_t buffer[4];
        uint8_t id1, id2;

        struct LCM_setting_table t1[] = {
                { 0xFF, 0x03, {0x98, 0x81, 0x01} }
        };
        struct LCM_setting_table t2[] = {
                { 0xFF, 0x03, {0x98, 0x81, 0x00} }
        };

        SET_RESET_PIN(1);
        SET_RESET_PIN(0);
        MDELAY(1);
        SET_RESET_PIN(1);
        MDELAY(20);
        push_table(NULL, t1, sizeof(t1) / sizeof(struct LCM_setting_table), 1);
        data_array[0] = 0x23700;
        dsi_set_cmdq(data_array, 1, 1);
        read_reg_v2(0, buffer, 1);
        id1 = buffer[0];
        read_reg_v2(1, buffer, 1);
        id2 = buffer[0];
        push_table(NULL, t2, sizeof(t2) / sizeof(struct LCM_setting_table), 1);
        return id1 == 0x98 && id2 == 0x25;
}

static void lcm_setbacklight_cmdq(void *handle, unsigned int level)
{
        printk(KERN_INFO "lcm_setbacklight_cmdq\n");

        bl_level[0].para_list[0] = (level >> 4) & 0x0f;
        bl_level[0].para_list[1] = (level << 4);
        push_table(NULL, bl_level, sizeof(bl_level) / sizeof(struct LCM_setting_table), 1);
}

static unsigned int lcm_esd_check(void)
{
        char buffer[4];
        int array[4];
        array[0] = 0x13700;
        dsi_set_cmdq(array, 1, 1);
        read_reg_v2(0x53, buffer, 1);
        if (buffer[0] == 0x24) {
                return 0;
        }
        return 1;
}

static unsigned int lcm_ata_check(unsigned char *buffer)
{
        printk(KERN_INFO "lcm_ata_check\n");

        uint32_t data_array[3];
        uint8_t read_buffer[4];
        int ret;
        data_array[0] = 0x5390a;
        data_array[1] = 0x32c012a;
        data_array[2] = 0x84;
        dsi_set_cmdq(data_array, 3, 1);
        data_array[0] = 0x43700;
        dsi_set_cmdq(data_array, 1, 1);
        read_reg_v2(0x2a, read_buffer, 4);
        if ((read_buffer[0] == 0x01) && (read_buffer[1] == 0x2c)
         && (read_buffer[2] == 0x03) && (read_buffer[3] == 0x84)) {
                ret = 1;
        } else {
                ret = 0;
        }
        data_array[0] = 0x5390a;
        data_array[1] = 0x400002a;
        data_array[2] = 0xaf;
        dsi_set_cmdq(data_array, 3, 1);
        return ret;
}

static void *lcm_switch_mode(int mode)
{
        return NULL;
}


struct LCM_DRIVER mipi_nt36523w_inx_video_1200p_lcm_drv = {
        .name = "mipi_nt36523w_inx_video_1200p",
        .set_util_funcs = lcm_set_util_funcs,
        .get_params = lcm_get_params,
        .init = lcm_init,
        .suspend = lcm_suspend,
        .resume = lcm_resume,
        .init_power = lcm_init_power,
        .suspend_power = lcm_suspend_power,
        .resume_power = lcm_resume_power,
        .update = lcm_update,
        .compare_id = lcm_compare_id,
        .set_backlight_cmdq = lcm_setbacklight_cmdq,
        .esd_check = lcm_esd_check,
        .ata_check = lcm_ata_check,
        .switch_mode = lcm_switch_mode,
};
